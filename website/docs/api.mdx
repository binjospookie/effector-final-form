---
title: API
---

:::info
The description of some of the functions is taken from the [Final Form documentation](https://final-form.org/docs/final-form/types/FormAp)
:::

## createForm

Form creation function.

Takes the same [config](https://final-form.org/docs/final-form/types/Config) as `createForm` from Final Form with the differences

- you can't pass `debug` option
- you need to pass [`subscribeOn`](/docs/differences#form--field-subscriptions)

Returns:

- [api](docs/api#api)
- [$fields](docs/api#fields)
- [$formState](docs/api#formstate)
- [$registeredFields](docs/api#registeredfields)

```ts title="With initial values"
const { api, $fields, $formState, $registeredFields } = createForm({
  onSubmit: async (f) => {
    await sleep(1000);

    return f.firstName === 'Incorrect' ? { firstName: 'Submit Error' } : undefined;
  },
  validate: (f) => (f.firstName === '' ? { firstName: 'Can not be empty' } : undefined),
  initialValues: { firstName: '' },
  subscribeOn: ['values', 'errors', 'submitting', 'submitSucceeded', 'submitFailed', 'submitErrors'],
});
```

```ts title="Without initial values"
const subscribeOn = [
  'values',
  'errors',
  'submitting',
  'submitSucceeded',
  'submitFailed',
  'submitErrors',
] as const;

const { api, $fields, $formState, $registeredFields } = createForm<{
    firstName: string,
    typeof subscribeOn
}>({
  onSubmit: async (f) => {
    await sleep(1000);

    return f.firstName === 'Incorrect' ? { firstName: 'Submit Error' } : undefined;
  },
  validate: (f) => (f.firstName === '' ? { firstName: 'Can not be empty' } : undefined),
  subscribeOn: ['values', 'errors', 'submitting', 'submitSucceeded', 'submitFailed', 'submitErrors'],
});
```

## api

### blurFx

Blurs (marks inactive) the given field.

```ts
(name: string) => Promise<void>;
```

### changeFx

Changes the value of the given field.

```ts
<F extends keyof FormValues>(_: { name: F; value?: FormValues[F] }) => Promise<void>;
```

### focusFx

Focuses (marks active) the given field.

```ts
(name: string) => Promise<void>;
```

### initialize

Initializes the form to the values provided. All the values will be set to these values, and dirty and pristine will be calculated by performing a shallow-equals between the current values and the values last initialized with. The form will be pristine after this call.

```ts
(data: InitialFormValues | ((values: FormValues) => InitialFormValues)) => void
```

### pauseValidation

If called, validation will be paused until resumeValidation() is called.

```ts
() => void
```

### registerField

Registers a new field.

```ts
(_: { name: string; subscribeOn: string[]; config?: FieldConfig }) => Promise<Unsubscribe>;
```

### reset

Resets the values back to the initial values the form was initialized with. Or empties all the values if the form was not initialized. If you provide initialValues they will be used as the new initial values.

```ts
(initialValues: ?InitialFormValues) => Promise<void>;
```

### resetFieldState

Resets all of a field's flags (e.g. touched, visited, etc.) to their initial state.

```ts
(name: string) => Promise<void>;
```

### restart

Resets all form and field state. Same as calling reset(initialValues) on the form and resetFieldState() for each field. Form should be just as it was when it was first created.

```ts
(initialValues: ?InitialFormValues) => Promise<void>;
```

### resumeValidation

Resumes validation paused by pauseValidation(). If validation was blocked while it was paused, validation will be run.

```ts
() => Promise<void>;
```

### revalidateFx

Not presented in Final Form.

Triggers form revalidation. Can be useful when the form validation function depends on dynamic parameters (e.g. store value)

```ts
const setError = createEvent<string>();
const $error = createStore<string>('');

sample({ clock: setError, target: $error });
// highlight-next-line
sample({ clock: setError, target: api.reValidateFx });

const validationFx = attach(() => {
  effect: ({ fields, error }) => {
    if (fields.firstName.length <= 2) {
      return { firstName: error }
    }
  },
  source: $error,
  mapParams: (fields, error) => ({ fields, error })
})

setError('Incorrect value');
```

### setSubmitFn

Not presented in Final Form.

Allows you to dynamically set submit function. Uses `effect.use` under the hood.

```ts
(_: (values: FormValues) => Promise<SubmissionErrors | void>) => void
```

### setValidationFn

Not presented in Final Form.

Allows you to dynamically set validation function. Uses `effect.use` under the hood.

```ts
(_: (params: FormValues) => Promise<SubmissionErrors | void>) => void
```

### submitFx

Submits the form if there are currently no validation errors. It may return undefined or a Promise depending on the nature of the onSubmit configuration value given to the form when it was created.

```ts
() => Promise<Object | undefined | void>;
```

## $fields

## $formState

It is a _Store_ that stores the form state. The keys are taken from `subscribeOn` + `isValidationOnPause`

```ts title="Example"
const { $formState } = createForm({
  onSubmit: () => {},
  initialValues: { firstName: '' },
  subscribeOn: ['active', 'errors'],
});

$formState.getState(); // { active: null, errors: {}, isValidationPaused: false }
```

## $registeredFields

It is a _Store_ that stores a list of names of registered fields.

```ts title="Example"
const { $registeredFields, api } = createForm({
  onSubmit: () => {},
  initialValues: { firstName: '' },
  subscribeOn: ['active'],
});

$registeredFields.getState(); // []

api.registerField({ name: 'firstName', subscribeOn: ['value'] });
$registeredFields.getState(); // ['firstName']

api.registerField({ name: 'lastName', subscribeOn: ['value'] });
$registeredFields.getState(); // ['firstName', 'lastName']
```
